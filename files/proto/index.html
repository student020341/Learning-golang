<!-- <link rel="stylesheet" href="/misc/file/fontawesome.css"> -->
<!-- <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous"> -->
<link rel="stylesheet" href="/proto/file/styles/mdi.css">
<link rel="stylesheet" href="/proto/file/styles/junk.css">

<script src="/proto/file/vue.js"></script>
<script src="/proto/file/vue-router.js"></script>
<script src="/proto/file/idb.js"></script>
<script src="/proto/file/project-dbi.js"></script>

<!-- load vue components! -->
<script>
    let _components = [];
    const getTemplate = file => fetch(`/proto/file/templates/${file}`).then(response => response.text());
</script>
<script src="/proto/file/components/home.js"></script>
<script src="/proto/file/components/new-project.js"></script>
<script src="/proto/file/components/view-node.js"></script>
<script src="/proto/file/components/view-type.js"></script>
<script src="/proto/file/components/interaction.js"></script>

<div id="app">
    <template v-if="loading">
        <p>some stuff is loading</p>
    </template>
    <template v-else>
        <router-view></router-view>
    </template>
</div>

<script>

    // router
    const router = new VueRouter({
        mode: "history",
        base: "/proto"
    });

    // app
    const app = new Vue({
        router,
        data: {
            loading: true,
        }
    }).$mount("#app");
    // database interface for app
    const dbh = new ProjectDBI();

    // fetch templates & set up components for routes
    (async () => {

        // open db
        await dbh.open();

        // externally loaded components
        const external_components = await Promise.all(_components);
        const components = external_components.reduce((obj, component) => Object.assign(obj, component), {
            notFound: {
                path: "*",
                template: await getTemplate("not-found.html")
            }
        });

        const routes = Object.values(components).map(component => ({
            path: component.path,
            component
        }));

        app.$router.addRoutes(routes);
        
        app.loading = false;
    })();

    /**
     * todo
     * 
     * (bug) isolate include checkbox for multiple of same type
     * warn about deleting types that are in use by another type or interaction
     * remove invalid types from interactions and types
     * 
     */

</script>